name: Deploy to VPS

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          known_hosts: ${{ secrets.KNOWN_HOSTS }}

      - name: Deploy
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} "
            # Create directory if missing
            mkdir -p /root/EventLampFrontend
            
            # Initialize Git repo if needed
            if [ ! -d /root/EventLampFrontend/.git ]; then
              git clone https://github.com/yourusername/your-repo.git /root/EventLampFrontend
              cd /root/EventLampFrontend
            else
              cd /root/EventLampFrontend
              git reset --hard
              git pull origin main
            fi
            
            # Docker deployment
            docker-compose down
            docker-compose build --no-cache
            docker-compose up -d
          "
